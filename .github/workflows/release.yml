name: Continuous Deployment

on:
  workflow_dispatch:
  push:
    branches: [master]
    paths:
      - 'src/**'
      - 'stack/**'

env:
  STACK_VERSION: ${{ github.run_id }}
  STACK_IMAGE: arwynfr_homepage

jobs:
  release:
    runs-on: [self-hosted]
    steps:

      - name: Checkout source files
        uses: actions/checkout@v3

      - name: Build image
        run: docker build ./src --tag ${STACK_IMAGE}

      - name: Deploy stack
        run : docker stack deploy --compose-file ./stack/docker-compose.yml --prune homepage
